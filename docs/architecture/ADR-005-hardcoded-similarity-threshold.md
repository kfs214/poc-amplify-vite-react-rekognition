# ADR-005: 類似度閾値のハードコーディング

## ステータス
採用 (2025-10-28)

## コンテキスト
顔照合API（Rekognition）から返ってくる類似度スコアを判定する際、「どの程度似ていれば成功とするか」の閾値を設定する必要がある。

## 検討した選択肢

### 選択肢1: 設定ファイルで管理
```typescript
// config.json
{
  "similarityThreshold": 80
}
```

**メリット**: 
- 閾値を外部から変更可能
- コードを変更せずに調整できる

**デメリット**: 
- PoCでは不要な複雑性
- 設定ファイルの読み込みロジックが必要
- 環境変数管理が必要
- 過剰設計

### 選択肢2: 環境変数で管理
```typescript
const SIMILARITY_THRESHOLD = 
  parseInt(process.env.VITE_SIMILARITY_THRESHOLD || '80');
```

**メリット**: 
- 環境ごとに閾値を変更可能
- 設定ファイルよりシンプル

**デメリット**: 
- PoCでは環境ごとの違いが不要
- `.env`ファイルの管理が必要
- やや複雑

### 選択肢3: ハードコーディング（採用）
```typescript
const SIMILARITY_THRESHOLD = 80;
```

**メリット**:
- 実装が最もシンプル
- PoCとして十分
- コードを見れば閾値が一目瞭然
- 変更が必要なら直接コードを修正すればよい

**デメリット**: 
- 閾値を変更するにはコード変更が必要

### 選択肢4: UI上で調整可能
画面に「閾値: [スライダー]」を配置

**メリット**: 
- リアルタイムで閾値を試せる
- デモとして面白い

**デメリット**: 
- PoCの目的から逸脱
- UI実装コストが増加
- 本番環境では使わない機能

## 決定
**選択肢3: ハードコーディング** を採用

## 理由
- PoCの目的は「Look & Feel」の体験であり、閾値の調整機能ではない
- Rekognition推奨閾値（80-90）を使用すれば十分
- 実装が最もシンプル
- 必要なら後で簡単に変更できる
- 選択肢1, 2は過剰設計

## 実装
```typescript
// src/screens/ResultScreen.tsx
const SIMILARITY_THRESHOLD = 80; // Rekognition推奨値

// 判定ロジック
if (similarity >= SIMILARITY_THRESHOLD) {
  // 照合成功
  console.log('✓ 照合成功');
} else {
  // 照合失敗
  console.log('✗ 照合失敗');
}
```

## 閾値の根拠
Amazon Rekognitionの公式推奨値：
- **80-90%**: 顔認証（本人確認）
- **95%以上**: 厳格な本人確認（金融など）
- **70%未満**: 低精度、推奨しない

PoCでは一般的な顔認証を想定し、**80%**を採用。

## 影響
- `ResultScreen.tsx`に定数として定義
- 閾値を変更する場合はコードを直接修正
- デザイナーへのデモ時に「閾値は80%で判定しています」と説明可能

## 将来的な拡張
本番環境では以下を検討：
- ユースケースごとに閾値を変更（通常認証: 80%, 重要操作: 90%）
- 環境変数での管理
- DynamoDBでの閾値管理（動的変更）

ただし、PoCではこれらは不要。

## 参考
- MASTER_PLAN.md タスク9.3
- スレッドでの議論: "閾値設定... PoC用に定数でハードコーディングが良い"
- Rekognition公式ドキュメント: https://docs.aws.amazon.com/rekognition/latest/dg/face-comparison.html

