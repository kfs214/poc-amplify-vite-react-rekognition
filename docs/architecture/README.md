# アーキテクチャ決定記録（ADR）

このディレクトリには、顔認証PoCプロジェクトの重要な設計判断を記録したArchitecture Decision Records（ADR）が含まれています。

## ADRとは？

ADR（Architecture Decision Record）は、ソフトウェアアーキテクチャの重要な決定を記録するドキュメントです。以下の情報を含みます：

- **何を決定したか**（What）
- **なぜその決定をしたのか**（Why）
- **どのような選択肢を検討したか**（Alternatives）
- **そのトレードオフは何か**（Trade-offs）

## なぜADRが必要か？

1. **コンテキストの保存**: 数ヶ月後や別の開発者が見ても「なぜこうなっているのか」が分かる
2. **議論の記録**: スレッドでの会話は流れるが、ADRは永続的
3. **学習資料**: 新しいメンバーが設計思想を理解できる
4. **変更の判断材料**: 将来的に変更する際、当時の判断理由を参照できる

## ADR一覧

### [ADR-001: 3画面構成とモックヘッダー](./ADR-001-three-screen-architecture.md)
**決定**: 単一アプリ内で3画面を実装し、各画面にモックヘッダーを表示  
**理由**: 開発コストをかけずに、デザイナーが実行コンテキストの違いを理解できる  
**トレードオフ**: 完全に本番環境を再現しているわけではない

### [ADR-002: アップロードとDB確認の並行処理](./ADR-002-parallel-upload-and-db-check.md)
**決定**: `Promise.all`で並行処理を実装  
**理由**: 体感ローディング時間を50%短縮、実装コスト+10行程度  
**トレードオフ**: 逐次処理よりやや複雑

### [ADR-003: 同期的な顔照合API呼び出し](./ADR-003-synchronous-face-comparison.md)
**決定**: REST APIで同期的に顔照合を実行  
**理由**: 非同期（イベント駆動）より圧倒的にシンプル、PoCとして十分  
**トレードオフ**: ユーザーが2-5秒待つ必要がある

### [ADR-004: Owner-based認可モデル](./ADR-004-owner-based-authorization.md)
**決定**: Cognito User Poolsのowner-based認可を採用  
**理由**: 顔画像データは本人のみがアクセスすべき  
**トレードオフ**: API Key認証より設定がやや複雑

### [ADR-005: 類似度閾値のハードコーディング](./ADR-005-hardcoded-similarity-threshold.md)
**決定**: 閾値80%を定数としてハードコーディング  
**理由**: PoCでは設定ファイルや環境変数は過剰設計  
**トレードオフ**: 閾値変更にはコード修正が必要

### [ADR-006: Storage（S3）の非公開設定](./ADR-006-storage-private-access.md)
**決定**: すべての画像をオーナーのみアクセス可能に設定  
**理由**: PoCでは外部公開不要、セキュリティを優先  
**トレードオフ**: 本番で公開機能が必要なら設定変更が必要

## ADRのフォーマット

各ADRは以下の構造に従っています：

```markdown
# ADR-XXX: タイトル

## ステータス
採用/却下/廃止 (日付)

## コンテキスト
どのような状況で、何を決定する必要があったのか？

## 検討した選択肢
### 選択肢1
### 選択肢2
### 選択肢3（採用）

## 決定
何を採用したか？

## 理由
なぜその決定をしたのか？

## 実装
具体的にどう実装するか？

## 影響
この決定がプロジェクトにどう影響するか？

## 参考
関連ドキュメント、スレッドへのリンクなど
```

## 関連ドキュメント

- [MASTER_PLAN.md](../../MASTER_PLAN.md) - 実装マイルストーン
- [.cursor/docs/amplify_rules.md](../../.cursor/docs/amplify_rules.md) - Amplifyルール
- [.cursor/docs/commit_rules.md](../../.cursor/docs/commit_rules.md) - コミットルール

## 新しいADRの追加方法

重要な設計判断が必要になった場合：

1. `ADR-XXX-descriptive-name.md`という名前でファイルを作成
2. 上記のフォーマットに従って記述
3. このREADMEの一覧に追加
4. 実装前にレビュー

---

**作成日**: 2025-10-28  
**プロジェクト**: 顔認証PoC（AWS Amplify Gen 2）

